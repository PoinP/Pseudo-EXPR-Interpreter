<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>FunctionCaller.h</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
    <body onload="prettyPrint()">
        <h4></h4>
        <pre class="prettyprint lang-cpp linenums">
#ifndef FUNCTION_CALLER_H

#define FUNCTION_CALLER_H

#include "Expression.h"
#include "FunctionDeclaration.h"

/// Handles function calling
///
/// This class is responsible for
/// searching for a declared function
/// in the Environmnet and invoking it
/// though a FunctionDeclaration object
class FunctionCaller : public Expression
{
public:
	/// A FunctionCaller constructor
	///
	/// Makes an object that stores in itself
	/// the token of the function you want to
	/// invoke and the argument which is passed
	/// to said function
	/// @param func The token of the function to invoke
	/// @param arg The argument that is passed to the
	/// invoked function
	FunctionCaller(const Token&amp; func, Expression* arg)
<span style = "background-color:#dfd">		: m_Func(func), m_Arg(arg)
	{}</span>

	/// Deletes the argument
	~FunctionCaller()
<span style = "background-color:#dfd">	{
		delete m_Arg;
	}</span>

	/// Invokes the function in the secified environment
	///
	/// Before invkoing a function, a local function
	/// Environment is created which is used for invoking
	/// the function. This allows for the creation of 
	/// recursive functions.
	/// @returns The value of the function's evaluation
	/// @throws RunTimeError if the function is undefined 
	/// @throws RunTimeError if there was an internal error 
	BigInteger evaluate(Environment* env) const override
<span style = "background-color:#dfd">	{
		Environment functionScope(env);</span>

<span style = "background-color:#dfd">		if (!functionScope.contains(m_Func.getIdentifier()))</span>
		{
<span style = "background-color:#dfd">			delete m_Arg;
			throw RunTimeError("Function \"" + m_Func.getIdentifier() + "\" undefined", m_Func.getLine());</span>
		}

<span style = "background-color:#dfd">		const Expression* funcExpr = functionScope.get(m_Func.getIdentifier());
		const FunctionDeclaration* func = dynamic_cast&lt;const FunctionDeclaration*&gt;(funcExpr);</span>

<span style = "background-color:#dfd">		if (!func)</span>
		{
<span style = "background-color:#fdd">			delete m_Arg;
			throw RunTimeError("Internal error! Expression not a function!", m_Func.getLine());</span>
		}

<span style = "background-color:#dfd">		BigInteger argValue = m_Arg-&gt;evaluate(&amp;functionScope);
		functionScope.setOnSelf(func-&gt;getParamName(), new Primitive(argValue));</span>

<span style = "background-color:#dfd">		return func-&gt;getBody()-&gt;evaluate(&amp;functionScope);
	}</span>

private:
	/// The function's token
	Token m_Func;
	/// The argument that is passed
	/// to the function
	Expression* m_Arg;
};

#endif // !FUNCTION_CALLER_H</pre>
        <hr />
        <table width="100%">
            <thead>
                <tr>
                    <th align="center">
                        <small>Generated by</small>
                        <a href="https://github.com/OpenCppCoverage/OpenCppCoverage/releases">
                            <strong>OpenCppCoverage (Version: 0.9.9.0)</strong>
                        </a>
                    </th>
                </tr>
            </thead>
        </table>
    </body>
</html>